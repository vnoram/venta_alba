<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Carrito - Tienda Oficial Colo Colo</title>

    <link rel="stylesheet" href="style.css">

</head>

<body>

    <header>
        <div class="logo">
            <img src="img/logo-colo-colo.png" alt="Logo Colo Colo">
            Tienda Oficial Colo Colo
        </div>
        <nav>
            <span class="menu-toggle" onclick="toggleMenu()">☰</span>
            <ul id="nav-links">
                <li><a href="index.html#inicio">Inicio</a></li>
                <li><a href="index.html#productos">Productos</a></li>
                <li><a href="carrito.html">Carrito</a></li>
                <li><a href="index.html#contacto">Contacto</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <section id="carrito">
            <h2>Carrito de Compras</h2>
            <h3>cada conpra participa por una gata fea</h3>
            <p id="carrito-vacio" class="mensaje-vacio" hidden>Tu carrito está vacío. Agrega productos desde la tienda.</p>
            <ul id="lista-carrito"></ul>
            <p>Total: <span id="total">0</span> CLP</p>
            <button id="btn-comprar">Comprar Ahora</button>
            <p><a href="index.html#productos">Volver a productos</a></p>
        </section>
         <section id="modal-pago" class="modal" aria-hidden="true">
            <div class="modal-contenido">
                <button id="cerrar-modal" class="btn-cerrar" aria-label="Cerrar">×</button>
                <h3>Finalizar compra</h3>
                <p class="texto-secundario">Selecciona tu método de pago y confirma el pedido.</p>

                <div class="resumen-compra">
                    <h4>Resumen</h4>
                    <ul id="resumen-items"></ul>
                    <p class="total-modal">Total: <span id="resumen-total">$0 CLP</span></p>
                </div>

                <form id="form-pago">
                    <label for="correo">Correo de contacto</label>
                    <input type="email" id="correo" name="correo" placeholder="tu@correo.cl" required>

                    <label for="metodo">Método de pago</label>
                    <select id="metodo" name="metodo" required>
                        <option value="paypal">PayPal</option>
                        <option value="tarjeta">Tarjeta de crédito/débito</option>
                    </select>

                    <p class="nota-pago">Usamos el total para construir un enlace de ejemplo de PayPal. No se efectuará un cobro real.</p>

                    <div class="acciones-modal">
                        <button type="button" id="btn-cancelar" class="btn-secundario">Seguir comprando</button>
                        <button type="submit" class="btn-principal">Pagar ahora</button>
                    </div>
                </form>
            </div>
        </section>

    </main>

    <footer>
        &copy; 2024 Tienda Oficial Colo Colo - Todos los derechos reservados
    </footer>

    <script>
        function toggleMenu() {
            const navLinks = document.getElementById('nav-links');
            navLinks.classList.toggle('show');
        }

        document.addEventListener('DOMContentLoaded', () => {
            const listaCarrito = document.getElementById('lista-carrito');
            const totalSpan = document.getElementById('total');
            const btnComprar = document.getElementById('btn-comprar');
            const modalPago = document.getElementById('modal-pago');
            const resumenItems = document.getElementById('resumen-items');
            const resumenTotal = document.getElementById('resumen-total');
            const btnCancelar = document.getElementById('btn-cancelar');
            const btnCerrar = document.getElementById('cerrar-modal');
            const formularioPago = document.getElementById('form-pago');
            const correoInput = document.getElementById('correo');
            function obtenerCarrito() {
                const datosGuardados = localStorage.getItem('carrito');
                return datosGuardados ? JSON.parse(datosGuardados) : [];
            }

            function guardarCarrito(carrito) {
                localStorage.setItem('carrito', JSON.stringify(carrito));
            }

            function actualizarCarrito() {
                const carrito = obtenerCarrito();
                listaCarrito.innerHTML = '';
                const carritoVacio = document.getElementById('carrito-vacio');
                let total = 0;

                if (carrito.length === 0) {
                    carritoVacio.hidden = false;
                } else {
                    carritoVacio.hidden = true;

                    carrito.forEach(item => {
                        const li = document.createElement('li');
                        li.textContent = `${item.nombre} - $${item.precio.toLocaleString('es-CL')} CLP`;
                        listaCarrito.appendChild(li);
                        total += item.precio;
                    });
                }

                totalSpan.textContent = total.toLocaleString('es-CL');
            }

            btnComprar.addEventListener('click', () => {
                const carrito = obtenerCarrito();

                if (carrito.length === 0) {
                    alert('Tu carrito está vacío. Agrega productos para comprar.');
                    return;
                }
                mostrarModalPago(carrito);
            });

            function mostrarModalPago(carrito) {
                resumenItems.innerHTML = '';
                let total = 0;

                carrito.forEach(item => {
                    const li = document.createElement('li');
                    li.textContent = `${item.nombre} - $${item.precio.toLocaleString('es-CL')} CLP`;
                    resumenItems.appendChild(li);
                    total += item.precio;
                });

                resumenTotal.textContent = `$${total.toLocaleString('es-CL')} CLP`;
                modalPago.classList.add('visible');
                modalPago.setAttribute('aria-hidden', 'false');
                correoInput.focus();
            }

            function cerrarModal() {
                modalPago.classList.remove('visible');
                modalPago.setAttribute('aria-hidden', 'true');
            }

            btnCancelar.addEventListener('click', cerrarModal);
            btnCerrar.addEventListener('click', cerrarModal);

            modalPago.addEventListener('click', (evento) => {
                if (evento.target === modalPago) {
                    cerrarModal();
                }
            });

            formularioPago.addEventListener('submit', (evento) => {
                evento.preventDefault();
                const carrito = obtenerCarrito();
                const total = carrito.reduce((acum, item) => acum + item.precio, 0);
                const metodo = document.getElementById('metodo').value;
                const correo = correoInput.value;

                if (metodo === 'paypal') {
                    const urlPaypal = `https://www.paypal.com/checkoutnow?amount=${encodeURIComponent(total)}&currencyCode=CLP`;
                    window.open(urlPaypal, '_blank');
                }

                alert(`¡Gracias por tu compra, ${correo}!\nMétodo: ${metodo === 'paypal' ? 'PayPal' : 'Tarjeta'}\nTotal: $${total.toLocaleString('es-CL')} CLP`);
                

                guardarCarrito([]);
                actualizarCarrito();
                cerrarModal();
            });

            actualizarCarrito();
        });
    </script>
</body>

</html>